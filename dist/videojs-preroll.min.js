/*! videojs-preroll - v0.2.0 - 2014-12-19
* Copyright (c) 2014 Sano Webdevelopment;
* Copyright (c) 2014 The Onion
* Licensed MIT */
!function(e,r){"use strict";var l,o={src:"",type:"",href:"",target:"_blank",allowSkip:!0,skipTime:5,repeatAd:!1};l=function(l){var t=r.util.mergeOptions(o,l),n=this;n.preroll={adDone:!1},n.on("contentupdate",function(){n.trigger(n.preroll.shouldPlayPreroll()?"adsready":"adscanceled")}),n.on("readyforpreroll",function(){if(!n.preroll.shouldPlayPreroll())return void n.trigger("adscanceled");if(n.ads.startLinearAdMode(),n.src({src:t.src,type:""===t.type?n.type:t.type}),n.one("durationchange",function(){n.play()}),n.one("progress",function(){n.play()}),""!==t.href){var r=document.createElement("a");r.className="preroll-blocker",r.href=t.href,r.target=t.target||"_blank",r.onclick=function(){n.trigger("adclick")},n.preroll.blocker=r,n.el().insertBefore(r,n.controlBar.el())}if(t.allowSkip!==!1){var l=document.createElement("div");l.className="preroll-skip-button",n.preroll.skipButton=l,n.el().appendChild(l),l.onclick=function(r){var l=l||e.Event;return(" "+n.preroll.skipButton.className+" ").indexOf(" enabled ")>=0&&n.preroll.exitPreroll(),void 0===l.prototype.stopPropagation?!1:void r.stopPropagation()},n.on("timeupdate",n.preroll.timeupdate)}n.one("ended",n.preroll.exitPreroll),n.one("error",n.preroll.prerollError)}),n.preroll.shouldPlayPreroll=function(){return""===t.src?!1:n.preroll.adDone===!0?!1:!0},n.preroll.exitPreroll=function(){"undefined"!=typeof n.preroll.skipButton&&n.preroll.skipButton.parentNode.removeChild(n.preroll.skipButton),"undefined"!=typeof n.preroll.blocker&&n.preroll.blocker.parentNode.removeChild(n.preroll.blocker),n.off("timeupdate",n.preroll.timeupdate),n.off("ended",n.preroll.exitPreroll),n.off("error",n.preroll.prerollError),t.repeatAd!==!0&&(n.preroll.adDone=!0),n.ads.endLinearAdMode()},n.preroll.timeupdate=function(){n.loadingSpinner.el().style.display="none";var e=Math.ceil(t.skipTime-n.currentTime());e>0?n.preroll.skipButton.innerHTML="Skip in "+e+"...":-1===(" "+n.preroll.skipButton.className+" ").indexOf(" enabled ")&&(n.preroll.skipButton.className+=" enabled",n.preroll.skipButton.innerHTML="Skip")},n.preroll.prerollError=function(){n.preroll.exitPreroll()},n.currentSrc()&&n.trigger(n.preroll.shouldPlayPreroll()?"adsready":"adscanceled")},r.plugin("preroll",l)}(window,window.videojs);