<!doctype html>
  <html>
  <head>
    <meta charset="utf-8">
    <title>videojs-preroll Demo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.19.0/video-js.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-ads/6.9.0/videojs-contrib-ads.css">
    <link href="dist/videojs-preroll.css" rel="stylesheet">
  </head>
  <body>
    <video id="videojs-preroll-player" class="video-js vjs-default-skin" controls autoplay>

    </video>
    <ul>
      <li><a href="/test/debug.html">Run unit tests in browser.</a></li>

    </ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.19.0/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-ads/6.9.0/videojs.ads.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-playlist@4.3.1/dist/videojs-playlist.js"></script>
    <script src="dist/videojs-preroll.js"></script>
    <script>
      (function(window, videojs) {


        const SeekBar = videojs.getComponent('SeekBar')

        SeekBar.prototype.getPercent = function getPercent() {
        // Allows for smooth scrubbing, when player can't keep up.
        // const time = (this.player_.scrubbing()) ?
        // this.player_.getCache().currentTime :
        // this.player_.currentTime()
        const time = this.player_.currentTime()
        const percent = time / this.player_.duration()
        return percent >= 1 ? 1 : percent
      }

      SeekBar.prototype.handleMouseMove = function handleMouseMove(event) {
        let newTime = this.calculateDistance(event) * this.player_.duration()
        if (newTime === this.player_.duration()) {
          newTime = newTime - 0.1
        }
        this.player_.currentTime(newTime)
        this.update()
      }

      var examplePlayer = window.examplePlayer = videojs('videojs-preroll-player', {
        autoplay: true,
        playbackRates: [1,2,3],
      });

      let adSources = [
      {
        src: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
        type: 'video/mp4',
        adId: '123'
      },
      {
        src: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4',
        type: 'video/mp4',
        adId: '124'
      },
      {
        src: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
        type: 'video/mp4',
        adId: '126'
      },
      {
        src: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4',
        type: 'video/mp4',
        adId: '125'
      },
      {
        src: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/VolkswagenGTIReview.mp4',
        type: 'video/mp4',
        adId: '128'
      },
      ];

      var preroll = window.preroll = examplePlayer.preroll({
        src:{src: adSources[0].src ,type:"video/mp4"},
        href:"http://videojs.com",
        adSign: true,
        allowSkip: true,
        repeatAd: false,
        showRemaining: false,
        adsOptions: {debug:true}
      });

      examplePlayer.playlist([{
        sources: [{
          src: 'http://media.w3.org/2010/05/sintel/trailer.mp4',
          type: 'video/mp4',
        }],
        poster: 'http://media.w3.org/2010/05/sintel/poster.png'
      }, {
        sources: [{
          src: 'http://media.w3.org/2010/05/bunny/trailer.mp4',
          type: 'video/mp4'
        }],
        poster: 'http://media.w3.org/2010/05/bunny/poster.png'
      }, {
        sources: [{
          src: 'http://vjs.zencdn.net/v/oceans.mp4',
          type: 'video/mp4'
        }],
        poster: 'http://www.videojs.com/img/poster.jpg'
      }, {
        sources: [{
          src: 'http://media.w3.org/2010/05/bunny/movie.mp4',
          type: 'video/mp4'
        }],
        poster: 'http://media.w3.org/2010/05/bunny/poster.png'
      }, {
        sources: [{
          src: 'http://media.w3.org/2010/05/video/movie_300.mp4',
          type: 'video/mp4'
        }],
        poster: 'http://media.w3.org/2010/05/video/poster.png'
      }]);

      // Play through the playlist automatically.
      examplePlayer.playlist.autoadvance(0);



      examplePlayer.on('beforeplaylistitem', function(){
        let currentVideoIndex = examplePlayer.playlist.currentIndex();
        console.log('Current Index: ', currentVideoIndex);
        examplePlayer.preroll.options.allowSkip = true;
        examplePlayer.preroll.adDone = false;
        examplePlayer.preroll.options.src = adSources[currentVideoIndex + 1];
        if(currentVideoIndex >= 1){
          examplePlayer.preroll.options.repeatAd = false;
        }
      });

      examplePlayer.on('adclick', function(e){
        console.log('Ad clicked');

        adSources.map(item => {
          const prerollVidSrc = examplePlayer.preroll.options.src;
          if(item.src.toString() === prerollVidSrc.src.toString()) {console.log('Match Found: ', item);}
        });
      });


    }(window, window.videojs));
  </script>
</body>
</html>
